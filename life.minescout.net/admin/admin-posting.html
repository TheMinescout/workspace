<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Content Creator</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        #post-content::-webkit-scrollbar, #announcement-text::-webkit-scrollbar { width: 8px; }
        #post-content::-webkit-scrollbar-thumb, #announcement-text::-webkit-scrollbar-thumb { background-color: #A7F3D0; border-radius: 4px; }
        #post-content::-webkit-scrollbar-track, #announcement-text::-webkit-scrollbar-track { background-color: #1F2937; }
        .container-bg { background-color: #111827; }
        .main-header { width: 100%; background-color: #1F2937; padding: 1rem 0; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2); position: fixed; top: 0; left: 0; z-index: 50; }
        .site-title-container { display: flex; justify-content: space-between; align-items: center; max-width: 1280px; margin: 0 auto; padding: 0 1rem; }
        .site-title-wrapper { text-align: center; flex-grow: 1; }
        .site-title { font-size: 2.25rem; font-weight: 800; color: white; line-height: 1; }
        .tagline { font-size: 0.875rem; color: #9CA3AF; line-height: 1; }
        #auth-container { text-align: left; }
        #user-display { display: flex; align-items: center; justify-content: flex-end; min-width: 100px; }
        #login-link, #signOut-btn { color: #A7F3D0; font-weight: 600; text-decoration: none; padding: 0.5rem 1rem; border-radius: 0.375rem; border: 1px solid #A7F3D0; transition: all 0.2s; }
        #login-link:hover, #signOut-btn:hover { background-color: #A7F3D0; color: #111827; }
        #user-email-display { color: white; font-size: 0.875rem; margin-right: 10px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .hidden { display: none !important; }
    </style>
</head>
<body class="container-bg min-h-screen flex flex-col items-center p-0">

    <header class="main-header">
        <div class="site-title-container">
            <div id="auth-container">
                <a href="../login.html" id="login-link">Login</a>
            </div>
            <div class="site-title-wrapper">
                <h1 class="site-title"><a href="../index.html" style="color: white; text-decoration: none;">Minescouts Life</a></h1>
                <p class="tagline">Admin Content Creator</p>
            </div>
            <div id="user-display" class="hidden">
                <span id="user-email-display"></span>
                <button id="signOut-btn">Sign Out</button>
            </div>
        </div>
    </header>

    <div id="app" class="w-full max-w-2xl bg-gray-900 shadow-2xl rounded-xl p-8 space-y-6 border border-gray-700 mt-24 mb-8">
        <h1 class="text-3xl font-extrabold text-white text-center tracking-tight">Create New Content</h1>
        
        <form id="post-form" class="space-y-6">
            
            <!-- Content Type Selector -->
            <div>
                <label class="block text-sm font-medium text-gray-300 mb-2">Content Type</label>
                <div class="flex gap-4 items-center bg-gray-800 border-2 border-gray-700 rounded-lg p-2">
                    <label class="flex-1 text-center p-2 rounded-md transition cursor-pointer has-[:checked]:bg-green-600">
                        <input type="radio" name="contentType" value="post" class="sr-only" checked>
                        <span class="font-semibold text-white">Post</span>
                    </label>
                    <label class="flex-1 text-center p-2 rounded-md transition cursor-pointer has-[:checked]:bg-green-600">
                        <input type="radio" name="contentType" value="announcement" class="sr-only">
                        <span class="font-semibold text-white">Announcement</span>
                    </label>
                </div>
            </div>

            <!-- Fields for a Post -->
            <div id="post-fields" class="space-y-6">
                <div>
                    <label for="post-title" class="block text-sm font-medium text-gray-300 mb-2">Post Title</label>
                    <input type="text" id="post-title" class="w-full p-3 rounded-lg border-2 border-gray-700 bg-gray-800 text-white placeholder-gray-500 focus:ring-green-400 focus:border-green-400 transition" placeholder="Enter the catchy title for the post">
                </div>
                <div>
                    <label for="post-category" class="block text-sm font-medium text-gray-300 mb-2">Category</label>
                    <select id="post-category" class="w-full p-3 rounded-lg border-2 border-gray-700 bg-gray-800 text-white focus:ring-green-400 focus:border-green-400 transition">
                        <option value="" disabled selected>Select a category...</option>
                        <option value="Coding Projects">Coding Projects</option>
                        <option value="Tech Tips">Tech Tips</option>
                        <option value="Updates">Updates</option>
                        <option value="Puppy Life">Puppy Life</option>
                        <option value="Minecraft Server">Minecraft Server</option>
                        <option value="General">General</option>
                        <option value="BETA">Beta Software</option>
                    </select>
                </div>
                <div>
                    <label for="post-link" class="block text-sm font-medium text-gray-300 mb-2">Post Link (URL)</label>
                    <input type="url" id="post-link" class="w-full p-3 rounded-lg border-2 border-gray-700 bg-gray-800 text-white placeholder-gray-500 focus:ring-green-400 focus:border-green-400 transition" placeholder="posts/tech/your-article.html">
                </div>
                <div>
                    <label for="image-link" class="block text-sm font-medium text-gray-300 mb-2">Title Image Link (URL) - Optional</label>
                    <input type="url" id="image-link" class="w-full p-3 rounded-lg border-2 border-gray-700 bg-gray-800 text-white placeholder-gray-500 focus:ring-green-400 focus:border-green-400 transition" placeholder="../assests/images/...">
                </div>
                <div>
                    <label for="post-content" class="block text-sm font-medium text-gray-300 mb-2">Summary</label>
                    <textarea id="post-content" rows="10" class="w-full p-3 rounded-lg border-2 border-gray-700 bg-gray-800 text-white placeholder-gray-500 focus:ring-green-400 focus:border-green-400 transition resize-none" placeholder="Write the summary of your post here..."></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Custom Publish Date & Time (Optional)</label>
                    <div class="flex gap-4">
                        <input type="date" id="post-date" class="w-full p-3 rounded-lg border-2 border-gray-700 bg-gray-800 text-white">
                        <input type="time" id="post-time" class="w-full p-3 rounded-lg border-2 border-gray-700 bg-gray-800 text-white">
                    </div>
                </div>
            </div>

            <!-- Fields for an Announcement -->
            <div id="announcement-fields" class="space-y-6 hidden">
                 <div>
                    <label for="announcement-title" class="block text-sm font-medium text-gray-300 mb-2">Title (the bolded part)</label>
                    <input type="text" id="announcement-title" class="w-full p-3 rounded-lg border-2 border-gray-700 bg-gray-800 text-white placeholder-gray-500 focus:ring-green-400 focus:border-green-400 transition" placeholder="e.g., Updates Underway">
                </div>
                <div>
                    <label for="announcement-text" class="block text-sm font-medium text-gray-300 mb-2">Announcement Text</label>
                    <textarea id="announcement-text" rows="5" class="w-full p-3 rounded-lg border-2 border-gray-700 bg-gray-800 text-white placeholder-gray-500 focus:ring-green-400 focus:border-green-400 transition resize-none" placeholder="The main content of the announcement..."></textarea>
                </div>
                 <div>
                    <label for="announcement-from" class="block text-sm font-medium text-gray-300 mb-2">From</label>
                    <input type="text" id="announcement-from" class="w-full p-3 rounded-lg border-2 border-gray-700 bg-gray-800 text-white placeholder-gray-500 focus:ring-green-400 focus:border-green-400 transition" placeholder="e.g., Minescouts Coding Team">
                </div>
            </div>

            <button type="submit" id="publish-btn" disabled class="w-full py-3 px-4 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg shadow-md transition duration-200 ease-in-out disabled:bg-gray-600 disabled:cursor-not-allowed">
                Publish Content
            </button>
        </form>

        <div id="status-message" class="text-center p-3 rounded-lg hidden"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getDatabase, ref, push, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAZE1qCY8YCZLrZ2EWT0QTFRoBVHvabqDM",
            authDomain: "minescout-life-4a668.firebaseapp.com",
            databaseURL: "https://minescout-life-4a668-default-rtdb.firebaseio.com",
            projectId: "minescout-life-4a668",
            storageBucket: "minescout-life-4a668.appspot.com",
            messagingSenderId: "351393417322",
            appId: "1:351393417322:web:92c9a92a50e60890136213",
            measurementId: "G-RFP78TP9KZ"
        };
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);
        let userId = null;

        const publishBtn = document.getElementById('publish-btn');
        const statusMessage = document.getElementById('status-message');
        const postForm = document.getElementById('post-form');
        const loginLink = document.getElementById('login-link');
        const userDisplay = document.getElementById('user-display');
        const userEmailDisplay = document.getElementById('user-email-display');
        const signOutBtn = document.getElementById('signOut-btn');
        const contentTypeRadios = document.querySelectorAll('input[name="contentType"]');
        const postFieldsContainer = document.getElementById('post-fields');
        const announcementFieldsContainer = document.getElementById('announcement-fields');
        
        const postInputs = postFieldsContainer.querySelectorAll('input, select, textarea');
        const announcementInputs = announcementFieldsContainer.querySelectorAll('input, textarea');

        function toggleForm(type) {
            if (type === 'post') {
                postFieldsContainer.classList.remove('hidden');
                announcementFieldsContainer.classList.add('hidden');
                document.getElementById('post-title').required = true;
                document.getElementById('post-category').required = true;
                document.getElementById('post-link').required = true;
                document.getElementById('post-content').required = true;
                document.getElementById('announcement-title').required = false;
                document.getElementById('announcement-text').required = false;
                document.getElementById('announcement-from').required = false;
            } else {
                postFieldsContainer.classList.add('hidden');
                announcementFieldsContainer.classList.remove('hidden');
                document.getElementById('post-title').required = false;
                document.getElementById('post-category').required = false;
                document.getElementById('post-link').required = false;
                document.getElementById('post-content').required = false;
                document.getElementById('announcement-title').required = true;
                document.getElementById('announcement-text').required = true;
                document.getElementById('announcement-from').required = true;
            }
        }
        
        contentTypeRadios.forEach(radio => radio.addEventListener('change', (e) => toggleForm(e.target.value)));
        toggleForm('post'); // Initialize form view

        onAuthStateChanged(auth, user => {
            if (user && !user.isAnonymous) {
                userId = user.uid;
                loginLink.classList.add('hidden');
                userDisplay.classList.remove('hidden');
                userEmailDisplay.textContent = user.email;
                publishBtn.disabled = false;
                publishBtn.textContent = "Publish Content";
            } else {
                userId = null;
                loginLink.classList.remove('hidden');
                userDisplay.classList.add('hidden');
                publishBtn.disabled = true;
                publishBtn.textContent = "Sign In To Publish";
            }
        });
        
        signOutBtn.addEventListener('click', () => signOut(auth).catch(err => console.error(err)));
        
        function displayMessage(message, isError = false) {
            statusMessage.textContent = message;
            statusMessage.className = `text-center p-3 rounded-lg ${isError ? 'bg-red-900 text-red-300' : 'bg-green-900 text-green-300'}`;
        }

        async function publishContent(event) {
            event.preventDefault();
            if (!userId) return displayMessage("You must be signed in.", true);

            const selectedType = document.querySelector('input[name="contentType"]:checked').value;
            publishBtn.disabled = true;
            publishBtn.textContent = "Publishing...";

            try {
                if (selectedType === 'post') {
                    await publishPost();
                } else {
                    await publishAnnouncement();
                }
                displayMessage(`Success! ${selectedType.charAt(0).toUpperCase() + selectedType.slice(1)} published.`, false);
                postForm.reset();
                toggleForm('post');
            } catch (error) {
                console.error("Publishing Error:", error);
                displayMessage(error.message, true);
            } finally {
                if (userId) {
                    publishBtn.disabled = false;
                    publishBtn.textContent = "Publish Content";
                }
            }
        }
        
        async function publishPost() {
            const title = document.getElementById('post-title').value.trim();
            const category = document.getElementById('post-category').value;
            const summary = document.getElementById('post-content').value.trim();
            const linkUrl = document.getElementById('post-link').value.trim();

            if (!title || !summary || !linkUrl || !category) throw new Error("Please fill out all required post fields.");
            
            const postDate = document.getElementById('post-date').value;
            const postTime = document.getElementById('post-time').value;
            let timestamp;
            if (postDate || postTime) {
                const datePart = postDate || new Date().toISOString().split('T')[0];
                const timePart = postTime || '00:00:00';
                timestamp = new Date(`${datePart}T${timePart}`).getTime();
            } else {
                timestamp = serverTimestamp();
            }

            const newPostData = {
                type: 'post', title, summary, linkUrl, category, authorId: userId, timestamp
            };
            const imageUrl = document.getElementById('image-link').value.trim();
            if (imageUrl) newPostData.imageUrl = imageUrl;

            await push(ref(db, 'content'), newPostData);
        }

        async function publishAnnouncement() {
            const title = document.getElementById('announcement-title').value.trim();
            const text = document.getElementById('announcement-text').value.trim();
            const from = document.getElementById('announcement-from').value.trim();
            if (!title || !text || !from) throw new Error("Please fill out all announcement fields.");

            const newAnnouncementData = {
                type: 'announcement', title, text, from, authorId: userId, timestamp: serverTimestamp()
            };
            await push(ref(db, 'content'), newAnnouncementData);
        }

        postForm.addEventListener('submit', publishContent);

    </script>
</body>
</html>